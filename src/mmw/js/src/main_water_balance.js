"use strict";

// Global jQuery needed for Bootstrap plugins.
var $ = require('jquery');
window.jQuery = window.$ = $;
require('bootstrap');
require('bootstrap-select');
var R = require('retina.js');

// Data
var data = {
    'sand': { // soil = 0
        'lir': { // land = 22
            '0.5': {'et': 0.0, 'i': 0.1, 'r': 0.3},
            '1'  : {'et': 0.0, 'i': 0.3, 'r': 0.7},
            '2'  : {'et': 0.0, 'i': 1.5, 'r': 0.4},
            '3.2': {'et': 0.0, 'i': 2.0, 'r': 1.2},
            '8'  : {'et': 0.0, 'i': 2.7, 'r': 5.3}
        },
        'hir': { // land = 23
            '0.5': {'et': 0.0, 'i': 0.0, 'r': 0.5},
            '1'  : {'et': 0.0, 'i': 0.0, 'r': 1.0},
            '2'  : {'et': 0.0, 'i': 1.0, 'r': 1.0},
            '3.2': {'et': 0.0, 'i': 1.1, 'r': 2.1},
            '8'  : {'et': 0.0, 'i': 1.3, 'r': 6.7}
        },
        'commercial': { // land = 24
            '0.5': {'et': 0.0, 'i': 0.0, 'r': 0.0},
            '1'  : {'et': 0.0, 'i': 0.0, 'r': 0.0},
            '2'  : {'et': 0.0, 'i': 0.0, 'r': 0.0},
            '3.2': {'et': 0.0, 'i': 0.0, 'r': 0.0},
            '8'  : {'et': 0.0, 'i': 0.0, 'r': 0.0}
        },
        'grassland': { // land = 71
            '0.5': {'et': 0.1, 'i': 0.4, 'r': 0.0},
            '1'  : {'et': 0.1, 'i': 0.9, 'r': 0.0},
            '2'  : {'et': 0.1, 'i': 1.9, 'r': 0.0},
            '3.2': {'et': 0.1, 'i': 3.1, 'r': 0.0},
            '8'  : {'et': 0.1, 'i': 7.5, 'r': 0.4}
        },
        'forest': { // land = 41, 42, 43
            '0.5': {'et': 0.1, 'i': 0.4, 'r': 0.0},
            '1'  : {'et': 0.1, 'i': 0.9, 'r': 0.0},
            '2'  : {'et': 0.1, 'i': 1.9, 'r': 0.0},
            '3.2': {'et': 0.1, 'i': 3.1, 'r': 0.0},
            '8'  : {'et': 0.1, 'i': 7.4, 'r': 0.4}
        },
        'turfGrass': { // land = 21
            '0.5': {'et': 0.1, 'i': 0.3, 'r': 0.1},
            '1'  : {'et': 0.1, 'i': 0.6, 'r': 0.3},
            '2'  : {'et': 0.1, 'i': 1.9, 'r': 0.0},
            '3.2': {'et': 0.1, 'i': 3.0, 'r': 0.2},
            '8'  : {'et': 0.1, 'i': 5.6, 'r': 2.4}
        },
        'pasture': { // land = 81
            '0.5': {'et': 0.1, 'i': 0.4, 'r': 0.0},
            '1'  : {'et': 0.1, 'i': 0.9, 'r': 0.0},
            '2'  : {'et': 0.1, 'i': 1.9, 'r': 0.0},
            '3.2': {'et': 0.1, 'i': 3.1, 'r': 0.0},
            '8'  : {'et': 0.1, 'i': 6.7, 'r': 1.2}
        },
        'rowCrops': { // land = 82
            '0.5': {'et': 0.2, 'i': 0.3, 'r': 0.0},
            '1'  : {'et': 0.2, 'i': 0.8, 'r': 0.0},
            '2'  : {'et': 0.2, 'i': 1.6, 'r': 0.2},
            '3.2': {'et': 0.2, 'i': 2.3, 'r': 0.7},
            '8'  : {'et': 0.2, 'i': 3.7, 'r': 4.1}
        },
        'chaparral': { // land = ??
            '0.5': {'et': 0.0, 'i': 0.0, 'r': 0.0},
            '1'  : {'et': 0.0, 'i': 0.0, 'r': 0.0},
            '2'  : {'et': 0.0, 'i': 0.0, 'r': 0.0},
            '3.2': {'et': 0.0, 'i': 0.0, 'r': 0.0},
            '8'  : {'et': 0.0, 'i': 0.0, 'r': 0.0}
        },
        'tallGrass': { // land = ??
            '0.5': {'et': 0.0, 'i': 0.0, 'r': 0.0},
            '1'  : {'et': 0.0, 'i': 0.0, 'r': 0.0},
            '2'  : {'et': 0.0, 'i': 0.0, 'r': 0.0},
            '3.2': {'et': 0.0, 'i': 0.0, 'r': 0.0},
            '8'  : {'et': 0.0, 'i': 0.0, 'r': 0.0}
        },
        'shortGrass': { // land = ??
            '0.5': {'et': 0.0, 'i': 0.0, 'r': 0.0},
            '1'  : {'et': 0.0, 'i': 0.0, 'r': 0.0},
            '2'  : {'et': 0.0, 'i': 0.0, 'r': 0.0},
            '3.2': {'et': 0.0, 'i': 0.0, 'r': 0.0},
            '8'  : {'et': 0.0, 'i': 0.0, 'r': 0.0}
        },
        'desert': { // land = ??
            '0.5': {'et': 0.0, 'i': 0.0, 'r': 0.0},
            '1'  : {'et': 0.0, 'i': 0.0, 'r': 0.0},
            '2'  : {'et': 0.0, 'i': 0.0, 'r': 0.0},
            '3.2': {'et': 0.0, 'i': 0.0, 'r': 0.0},
            '8'  : {'et': 0.0, 'i': 0.0, 'r': 0.0}
        }
    },
    'loam': { // soil = 1
        'lir': { // land = 22
            '0.5': {'et': 0.0, 'i': 0.1, 'r': 0.3},
            '1'  : {'et': 0.0, 'i': 0.3, 'r': 0.7},
            '2'  : {'et': 0.0, 'i': 1.2, 'r': 0.8},
            '3.2': {'et': 0.0, 'i': 1.4, 'r': 1.8},
            '8'  : {'et': 0.0, 'i': 1.7, 'r': 6.2}
        },
        'hir': { // land = 23
            '0.5': {'et': 0.0, 'i': 0.0, 'r': 0.5},
            '1'  : {'et': 0.0, 'i': 0.0, 'r': 1.0},
            '2'  : {'et': 0.0, 'i': 0.8, 'r': 1.2},
            '3.2': {'et': 0.0, 'i': 0.8, 'r': 2.4},
            '8'  : {'et': 0.0, 'i': 0.9, 'r': 7.0}
        },
        'commercial': { // land = 24
            '0.5': {'et': 0.0, 'i': 0.0, 'r': 0.0},
            '1'  : {'et': 0.0, 'i': 0.0, 'r': 0.0},
            '2'  : {'et': 0.0, 'i': 0.0, 'r': 0.0},
            '3.2': {'et': 0.0, 'i': 0.0, 'r': 0.0},
            '8'  : {'et': 0.0, 'i': 0.0, 'r': 0.0}
        },
        'grassland': { // land = 71
            '0.5': {'et': 0.1, 'i': 0.4, 'r': 0.0},
            '1'  : {'et': 0.1, 'i': 0.9, 'r': 0.0},
            '2'  : {'et': 0.1, 'i': 1.9, 'r': 0.0},
            '3.2': {'et': 0.1, 'i': 2.8, 'r': 0.3},
            '8'  : {'et': 0.1, 'i': 5.1, 'r': 2.8}
        },
        'forest': { // land = 41, 42, 43
            '0.5': {'et': 0.1, 'i': 0.4, 'r': 0.0},
            '1'  : {'et': 0.1, 'i': 0.9, 'r': 0.0},
            '2'  : {'et': 0.1, 'i': 1.8, 'r': 0.0},
            '3.2': {'et': 0.1, 'i': 2.8, 'r': 0.3},
            '8'  : {'et': 0.1, 'i': 5.1, 'r': 2.8}
        },
        'turfGrass': { // land = 21
            '0.5': {'et': 0.1, 'i': 0.3, 'r': 0.1},
            '1'  : {'et': 0.1, 'i': 0.6, 'r': 0.3},
            '2'  : {'et': 0.1, 'i': 1.7, 'r': 0.2},
            '3.2': {'et': 0.1, 'i': 2.4, 'r': 0.7},
            '8'  : {'et': 0.1, 'i': 3.7, 'r': 4.2}
        },
        'pasture': { // land = 81
            '0.5': {'et': 0.1, 'i': 0.4, 'r': 0.0},
            '1'  : {'et': 0.1, 'i': 0.9, 'r': 0.0},
            '2'  : {'et': 0.1, 'i': 1.8, 'r': 0.1},
            '3.2': {'et': 0.1, 'i': 2.6, 'r': 0.4},
            '8'  : {'et': 0.1, 'i': 4.4, 'r': 3.4}
        },
        'rowCrops': { // land = 82
            '0.5': {'et': 0.2, 'i': 0.3, 'r': 0.0},
            '1'  : {'et': 0.2, 'i': 0.8, 'r': 0.1},
            '2'  : {'et': 0.2, 'i': 1.3, 'r': 0.5},
            '3.2': {'et': 0.2, 'i': 1.7, 'r': 1.3},
            '8'  : {'et': 0.2, 'i': 2.4, 'r': 5.4}
        },
        'chaparral': { // land = ??
            '0.5': {'et': 0.0, 'i': 0.0, 'r': 0.0},
            '1'  : {'et': 0.0, 'i': 0.0, 'r': 0.0},
            '2'  : {'et': 0.0, 'i': 0.0, 'r': 0.0},
            '3.2': {'et': 0.0, 'i': 0.0, 'r': 0.0},
            '8'  : {'et': 0.0, 'i': 0.0, 'r': 0.0}
        },
        'tallGrass': { // land = ??
            '0.5': {'et': 0.0, 'i': 0.0, 'r': 0.0},
            '1'  : {'et': 0.0, 'i': 0.0, 'r': 0.0},
            '2'  : {'et': 0.0, 'i': 0.0, 'r': 0.0},
            '3.2': {'et': 0.0, 'i': 0.0, 'r': 0.0},
            '8'  : {'et': 0.0, 'i': 0.0, 'r': 0.0}
        },
        'shortGrass': { // land = ??
            '0.5': {'et': 0.0, 'i': 0.0, 'r': 0.0},
            '1'  : {'et': 0.0, 'i': 0.0, 'r': 0.0},
            '2'  : {'et': 0.0, 'i': 0.0, 'r': 0.0},
            '3.2': {'et': 0.0, 'i': 0.0, 'r': 0.0},
            '8'  : {'et': 0.0, 'i': 0.0, 'r': 0.0}
        },
        'desert': { // land = ??
            '0.5': {'et': 0.0, 'i': 0.0, 'r': 0.0},
            '1'  : {'et': 0.0, 'i': 0.0, 'r': 0.0},
            '2'  : {'et': 0.0, 'i': 0.0, 'r': 0.0},
            '3.2': {'et': 0.0, 'i': 0.0, 'r': 0.0},
            '8'  : {'et': 0.0, 'i': 0.0, 'r': 0.0}
        }
    },
    'sandyClay': { // soil = 2
        'lir': { // land = 22
            '0.5': {'et': 0.0, 'i': 0.1, 'r': 0.3},
            '1'  : {'et': 0.0, 'i': 0.3, 'r': 0.7},
            '2'  : {'et': 0.0, 'i': 0.9, 'r': 1.1},
            '3.2': {'et': 0.0, 'i': 1.0, 'r': 2.2},
            '8'  : {'et': 0.0, 'i': 1.2, 'r': 6.8}
        },
        'hir': { // land = 23
            '0.5': {'et': 0.0, 'i': 0.0, 'r': 0.5},
            '1'  : {'et': 0.0, 'i': 0.0, 'r': 1.0},
            '2'  : {'et': 0.0, 'i': 0.6, 'r': 1.4},
            '3.2': {'et': 0.0, 'i': 0.6, 'r': 2.5},
            '8'  : {'et': 0.0, 'i': 0.7, 'r': 7.3}
        },
        'commercial': { // land = 24
            '0.5': {'et': 0.0, 'i': 0.0, 'r': 0.0},
            '1'  : {'et': 0.0, 'i': 0.0, 'r': 0.0},
            '2'  : {'et': 0.0, 'i': 0.0, 'r': 0.0},
            '3.2': {'et': 0.0, 'i': 0.0, 'r': 0.0},
            '8'  : {'et': 0.0, 'i': 0.0, 'r': 0.0}
        },
        'grassland': { // land = 71
            '0.5': {'et': 0.1, 'i': 0.4, 'r': 0.0},
            '1'  : {'et': 0.1, 'i': 0.9, 'r': 0.0},
            '2'  : {'et': 0.1, 'i': 1.6, 'r': 0.2},
            '3.2': {'et': 0.1, 'i': 2.2, 'r': 0.8},
            '8'  : {'et': 0.1, 'i': 3.4, 'r': 4.5}
        },
        'forest': { // land = 41, 42, 43
            '0.5': {'et': 0.1, 'i': 0.4, 'r': 0.0},
            '1'  : {'et': 0.1, 'i': 0.8, 'r': 0.0},
            '2'  : {'et': 0.1, 'i': 1.6, 'r': 0.2},
            '3.2': {'et': 0.1, 'i': 2.2, 'r': 0.8},
            '8'  : {'et': 0.1, 'i': 3.4, 'r': 4.5}
        },
        'turfGrass': { // land = 21
            '0.5': {'et': 0.1, 'i': 0.3, 'r': 0.1},
            '1'  : {'et': 0.1, 'i': 0.6, 'r': 0.3},
            '2'  : {'et': 0.1, 'i': 1.7, 'r': 0.2},
            '3.2': {'et': 0.1, 'i': 2.4, 'r': 0.7},
            '8'  : {'et': 0.1, 'i': 3.7, 'r': 4.2}
        },
        'pasture': { // land = 81
            '0.5': {'et': 0.1, 'i': 0.4, 'r': 0.0},
            '1'  : {'et': 0.1, 'i': 0.9, 'r': 0.0},
            '2'  : {'et': 0.1, 'i': 1.5, 'r': 0.3},
            '3.2': {'et': 0.1, 'i': 2.0, 'r': 1.0},
            '8'  : {'et': 0.1, 'i': 2.9, 'r': 4.9}
        },
        'rowCrops': { // land = 82
            '0.5': {'et': 0.2, 'i': 0.3, 'r': 0.0},
            '1'  : {'et': 0.2, 'i': 0.6, 'r': 0.2},
            '2'  : {'et': 0.2, 'i': 1.0, 'r': 0.8},
            '3.2': {'et': 0.2, 'i': 1.3, 'r': 1.8},
            '8'  : {'et': 0.2, 'i': 1.6, 'r': 6.2}
        },
        'chaparral': { // land = ??
            '0.5': {'et': 0.0, 'i': 0.0, 'r': 0.0},
            '1'  : {'et': 0.0, 'i': 0.0, 'r': 0.0},
            '2'  : {'et': 0.0, 'i': 0.0, 'r': 0.0},
            '3.2': {'et': 0.0, 'i': 0.0, 'r': 0.0},
            '8'  : {'et': 0.0, 'i': 0.0, 'r': 0.0}
        },
        'tallGrass': { // land = ??
            '0.5': {'et': 0.0, 'i': 0.0, 'r': 0.0},
            '1'  : {'et': 0.0, 'i': 0.0, 'r': 0.0},
            '2'  : {'et': 0.0, 'i': 0.0, 'r': 0.0},
            '3.2': {'et': 0.0, 'i': 0.0, 'r': 0.0},
            '8'  : {'et': 0.0, 'i': 0.0, 'r': 0.0}
        },
        'shortGrass': { // land = ??
            '0.5': {'et': 0.0, 'i': 0.0, 'r': 0.0},
            '1'  : {'et': 0.0, 'i': 0.0, 'r': 0.0},
            '2'  : {'et': 0.0, 'i': 0.0, 'r': 0.0},
            '3.2': {'et': 0.0, 'i': 0.0, 'r': 0.0},
            '8'  : {'et': 0.0, 'i': 0.0, 'r': 0.0}
        },
        'desert': { // land = ??
            '0.5': {'et': 0.0, 'i': 0.0, 'r': 0.0},
            '1'  : {'et': 0.0, 'i': 0.0, 'r': 0.0},
            '2'  : {'et': 0.0, 'i': 0.0, 'r': 0.0},
            '3.2': {'et': 0.0, 'i': 0.0, 'r': 0.0},
            '8'  : {'et': 0.0, 'i': 0.0, 'r': 0.0}
        }
    },
    'clayLoam': { // soil = 3
        'lir': { // land = 22
            '0.5': {'et': 0.0, 'i': 0.1, 'r': 0.3},
            '1'  : {'et': 0.0, 'i': 0.3, 'r': 0.7},
            '2'  : {'et': 0.0, 'i': 0.7, 'r': 1.2},
            '3.2': {'et': 0.0, 'i': 0.8, 'r': 2.4},
            '8'  : {'et': 0.0, 'i': 0.9, 'r': 7.0}
        },
        'hir': { // land = 23
            '0.5': {'et': 0.0, 'i': 0.0, 'r': 0.5},
            '1'  : {'et': 0.0, 'i': 0.0, 'r': 1.0},
            '2'  : {'et': 0.0, 'i': 0.5, 'r': 1.5},
            '3.2': {'et': 0.0, 'i': 0.5, 'r': 2.6},
            '8'  : {'et': 0.0, 'i': 0.6, 'r': 7.4}
        },
        'commercial': { // land = 24
            '0.5': {'et': 0.0, 'i': 0.0, 'r': 0.0},
            '1'  : {'et': 0.0, 'i': 0.0, 'r': 0.0},
            '2'  : {'et': 0.0, 'i': 0.0, 'r': 0.0},
            '3.2': {'et': 0.0, 'i': 0.0, 'r': 0.0},
            '8'  : {'et': 0.0, 'i': 0.0, 'r': 0.0}
        },
        'grassland': { // land = 71
            '0.5': {'et': 0.1, 'i': 0.4, 'r': 0.0},
            '1'  : {'et': 0.1, 'i': 0.8, 'r': 0.0},
            '2'  : {'et': 0.1, 'i': 1.4, 'r': 0.4},
            '3.2': {'et': 0.1, 'i': 1.9, 'r': 1.2},
            '8'  : {'et': 0.1, 'i': 2.6, 'r': 5.3}
        },
        'forest': { // land = 41, 42, 43
            '0.5': {'et': 0.1, 'i': 0.4, 'r': 0.0},
            '1'  : {'et': 0.1, 'i': 0.8, 'r': 0.0},
            '2'  : {'et': 0.1, 'i': 1.4, 'r': 0.4},
            '3.2': {'et': 0.1, 'i': 1.8, 'r': 1.2},
            '8'  : {'et': 0.1, 'i': 2.6, 'r': 5.3}
        },
        'turfGrass': { // land = 21
            '0.5': {'et': 0.1, 'i': 0.3, 'r': 0.1},
            '1'  : {'et': 0.1, 'i': 0.6, 'r': 0.3},
            '2'  : {'et': 0.1, 'i': 1.2, 'r': 0.7},
            '3.2': {'et': 0.1, 'i': 1.4, 'r': 1.7},
            '8'  : {'et': 0.1, 'i': 1.8, 'r': 6.1}
        },
        'pasture': { // land = 81
            '0.5': {'et': 0.1, 'i': 0.4, 'r': 0.0},
            '1'  : {'et': 0.1, 'i': 0.8, 'r': 0.1},
            '2'  : {'et': 0.1, 'i': 1.3, 'r': 0.6},
            '3.2': {'et': 0.1, 'i': 1.7, 'r': 1.4},
            '8'  : {'et': 0.1, 'i': 2.2, 'r': 5.6}
        },
        'rowCrops': { // land = 82
            '0.5': {'et': 0.2, 'i': 0.3, 'r': 0.0},
            '1'  : {'et': 0.2, 'i': 0.5, 'r': 0.3},
            '2'  : {'et': 0.2, 'i': 0.8, 'r': 1.0},
            '3.2': {'et': 0.2, 'i': 0.9, 'r': 2.1},
            '8'  : {'et': 0.2, 'i': 1.1, 'r': 6.7}
        },
        'chaparral': { // land = ??
            '0.5': {'et': 0.0, 'i': 0.0, 'r': 0.0},
            '1'  : {'et': 0.0, 'i': 0.0, 'r': 0.0},
            '2'  : {'et': 0.0, 'i': 0.0, 'r': 0.0},
            '3.2': {'et': 0.0, 'i': 0.0, 'r': 0.0},
            '8'  : {'et': 0.0, 'i': 0.0, 'r': 0.0}
        },
        'tallGrass': { // land = ??
            '0.5': {'et': 0.0, 'i': 0.0, 'r': 0.0},
            '1'  : {'et': 0.0, 'i': 0.0, 'r': 0.0},
            '2'  : {'et': 0.0, 'i': 0.0, 'r': 0.0},
            '3.2': {'et': 0.0, 'i': 0.0, 'r': 0.0},
            '8'  : {'et': 0.0, 'i': 0.0, 'r': 0.0}
        },
        'shortGrass': { // land = ??
            '0.5': {'et': 0.0, 'i': 0.0, 'r': 0.0},
            '1'  : {'et': 0.0, 'i': 0.0, 'r': 0.0},
            '2'  : {'et': 0.0, 'i': 0.0, 'r': 0.0},
            '3.2': {'et': 0.0, 'i': 0.0, 'r': 0.0},
            '8'  : {'et': 0.0, 'i': 0.0, 'r': 0.0}
        },
        'desert': { // land = ??
            '0.5': {'et': 0.0, 'i': 0.0, 'r': 0.0},
            '1'  : {'et': 0.0, 'i': 0.0, 'r': 0.0},
            '2'  : {'et': 0.0, 'i': 0.0, 'r': 0.0},
            '3.2': {'et': 0.0, 'i': 0.0, 'r': 0.0},
            '8'  : {'et': 0.0, 'i': 0.0, 'r': 0.0}
        }
    }
};

// Used to convert slider values into data keys
var rainKey = ['0.5', '1', '2', '3.2', '8'];

$(function() {
    R.Retina.init(window);
    $('[data-toggle="tooltip"]').tooltip();

    // Cache references to DOM elements so as not to query them each time
    var $et = $('#column-et');
    var $r  = $('#column-r');
    var $i  = $('#column-i');

    var $thumbsLand = $('#thumbs-land');
    var $thumbsSoil = $('#thumbs-soil');
    var $rainSlider = $('#rain-slider');

    var $precipText = $('#well-precip > h1');
    var $evapoText = $('#well-evapo > h1');
    var $runoffText = $('#well-runoff > h1');
    var $infilText = $('#well-infil > h1');

    var getType = function($el) {
        // Return thumb type, after the 'thumb-' part of id
        return $el.attr('id').substring(6);
    };

    var recalculate = function() {
        var soil = getType($thumbsSoil.children('.active'));
        var land = getType($thumbsLand.children('.active'));
        var rain = rainKey[$rainSlider.val()];

        var result = data[soil][land][rain];

        $precipText.text(rain + '"');
        $evapoText.text(result.et + '"');
        $runoffText.text(result.r + '"');
        $infilText.text(result.i + '"');

        $et.css('height', (100 * result.et / parseFloat(rain)) + '%');
        $r.css('height', (100 * result.r / parseFloat(rain)) + '%');
        $i.css('height', (100 * result.i / parseFloat(rain)) + '%');

        // Set border radius for middle Runoff div
        // which has rounded borders whenever it is on the edge
        // but not when it is in the middle
        var topRadius = (result.et === 0) ? '0.3rem' : '0';
        var bottomRadius = (result.i === 0) ? '0.3rem' : '0';

        $r.css({
            'border-top-left-radius': topRadius,
            'border-top-right-radius': topRadius,
            'border-bottom-left-radius': bottomRadius,
            'border-bottom-right-radius': bottomRadius
        });
    };

    // Wire up events
    $rainSlider.change(recalculate);
    $('a[data-toggle="tab"]').on('shown.bs.tab', recalculate);

    // Trigger the first time page loads
    recalculate();
});
